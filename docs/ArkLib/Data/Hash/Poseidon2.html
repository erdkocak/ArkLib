<html lang="en"><head><meta charset="UTF-8"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><link rel="stylesheet" href="../../.././style.css"></link><link rel="icon" href="../../.././favicon.svg"></link><link rel="mask-icon" href="../../.././favicon.svg" color="#000000"></link><link rel="prefetch" href="../../.././/declarations/declaration-data.bmp" as="image"></link><title>ArkLib.Data.Hash.Poseidon2</title><script defer="true" src="../../.././mathjax-config.js"></script><script defer="true" src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script defer="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script>const SITE_ROOT="../../.././";</script><script>const MODULE_NAME="ArkLib.Data.Hash.Poseidon2";</script><script type="module" src="../../.././jump-src.js"></script><script type="module" src="../../.././search.js"></script><script type="module" src="../../.././expand-nav.js"></script><script type="module" src="../../.././how-about.js"></script><script type="module" src="../../.././instances.js"></script><script type="module" src="../../.././importedBy.js"></script></head><body><input id="nav_toggle" type="checkbox"></input><header><h1><label for="nav_toggle"></label><span>Documentation</span></h1><h2 class="header_filename break_within"><span class="name">ArkLib</span>.<span class="name">Data</span>.<span class="name">Hash</span>.<span class="name">Poseidon2</span></h2><form id="search_form"><input type="text" name="q" autocomplete="off"></input>&#32;<button id="search_button" onclick="javascript: form.action='../../.././search.html';">Search</button></form></header><nav class="internal_nav"><p><a href="#top">return to top</a></p><p class="gh_nav_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean">source</a></p><div class="imports"><details><summary>Imports</summary><ul><li><a href="../../.././Init.html">Init</a></li><li><a href="../../.././ArkLib/Data/Vector/Basic.html">ArkLib.Data.Vector.Basic</a></li><li><a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html">ArkLib.Data.FieldTheory.NonBinaryField.KoalaBear</a></li></ul></details><details><summary>Imported by</summary><ul id="imported-by-ArkLib.Data.Hash.Poseidon2" class="imported-by-list"></ul></details></div><div class="nav_link"><a class="break_within" href="#Poseidon2.rawConstants16"><span class="name">Poseidon2</span>.<span class="name">rawConstants16</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.RAW_CONSTANTS_24"><span class="name">Poseidon2</span>.<span class="name">RAW_CONSTANTS_24</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.sBoxDegree"><span class="name">Poseidon2</span>.<span class="name">sBoxDegree</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params"><span class="name">Poseidon2</span>.<span class="name">Params</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.width_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">width_pos</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.numFullRounds_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numFullRounds_pos</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.numPartialRounds_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numPartialRounds_pos</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.widthDiv4"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">widthDiv4</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.widthDiv4_mul_4_eq_width"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">widthDiv4_mul_4_eq_width</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.halfNumFullRounds"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">halfNumFullRounds</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.numFullRounds_dvd_by_2"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numFullRounds_dvd_by_2</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.Params.halfNumFullRounds_mul_2_eq_numFullRounds"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">halfNumFullRounds_mul_2_eq_numFullRounds</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.params16"><span class="name">Poseidon2</span>.<span class="name">params16</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.params24"><span class="name">Poseidon2</span>.<span class="name">params24</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.m4Matrix"><span class="name">Poseidon2</span>.<span class="name">m4Matrix</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.applyM4"><span class="name">Poseidon2</span>.<span class="name">applyM4</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.externalLinearLayer"><span class="name">Poseidon2</span>.<span class="name">externalLinearLayer</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.internalLinearLayer"><span class="name">Poseidon2</span>.<span class="name">internalLinearLayer</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.fullRound"><span class="name">Poseidon2</span>.<span class="name">fullRound</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.partialRound"><span class="name">Poseidon2</span>.<span class="name">partialRound</span></a></div><div class="nav_link"><a class="break_within" href="#Poseidon2.permute"><span class="name">Poseidon2</span>.<span class="name">permute</span></a></div></nav><main>
<div class="mod_doc"><h1 class="markdown-heading" id="Poseidon2-Reference-Implementation">Poseidon2 Reference Implementation <a class="hover-link" href="#Poseidon2-Reference-Implementation">#</a></h1><p>This is the Lean translation of the reference Python implementation of Poseidon2 in
<code>leanEthereum/leanSpec</code>, with KoalaBear as the base field.</p><p>The translation is done on Sep 12, 2025.</p><h2 class="markdown-heading" id="References">References <a class="hover-link" href="#References">#</a></h2><ul>
<li><p>Poseidon2: <a href="https://eprint.iacr.org/2023/323">Poseidon2: A Faster Version of the Poseidon Hash
Function</a></p>
</li>
<li><p>Lean Ethereum spec:
<a href="https://github.com/leanEthereum/leanSpec/blob/main/src/lean_spec/subspecs/poseidon2">https://github.com/leanEthereum/leanSpec/blob/main/src/lean_spec/subspecs/poseidon2</a></p>
</li>
</ul></div><div class="mod_doc"><p>First, we give the round constants</p></div><div class="decl" id="Poseidon2.rawConstants16"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L36-L187">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.rawConstants16"><span class="name">Poseidon2</span>.<span class="name">rawConstants16</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn">148</span></span></div></div><p>The constants for Poseidon2 with 16 rounds
(total of 8 * 16 + 20 = 148 constants)</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.rawConstants16" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.RAW_CONSTANTS_24"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L189-L407">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.RAW_CONSTANTS_24"><span class="name">Poseidon2</span>.<span class="name">RAW_CONSTANTS_24</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn">215</span></span></div></div><p>The constants for Poseidon2 with width 24
(total of 8 * 24 + 23 = 215 constants)</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.RAW_CONSTANTS_24" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.sBoxDegree"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L409-L410">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.sBoxDegree"><span class="name">Poseidon2</span>.<span class="name">sBoxDegree</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></div><p>The degree of the S-Box for Poseidon2 over the KoalaBear field</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.sBoxDegree" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.Params"><div class="structure"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L412-L435">source</a></div><div class="decl_header"><span class="decl_kind">structure</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params"><span class="name">Poseidon2</span>.<span class="name">Params</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././foundational_types.html">Type</a></div></div><p>The parameters determining a Poseidon2 permutation (over the KoalaBear field)</p><ul class="structure_fields" id="Poseidon2.Params.mk"><li id="Poseidon2.Params.width" class="structure_field"><div class="structure_field_info">width : <a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></li><li id="Poseidon2.Params.numFullRounds" class="structure_field"><div class="structure_field_info">numFullRounds : <a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></li><li id="Poseidon2.Params.numPartialRounds" class="structure_field"><div class="structure_field_info">numPartialRounds : <a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></li><li id="Poseidon2.Params.internalDiagVectors" class="structure_field"><div class="structure_field_info">internalDiagVectors : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></li><li id="Poseidon2.Params.roundConstants" class="structure_field"><div class="structure_field_info">roundConstants : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> (<span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span> <a href="../../.././Init/Prelude.html#HMul.hMul">*</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span> <a href="../../.././Init/Prelude.html#HAdd.hAdd">+</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numPartialRounds">numPartialRounds</a></span>)</span></div></li><li id="Poseidon2.Params.width_ne_zero" class="structure_field"><div class="structure_field_info">width_ne_zero : <span class="fn"><a href="../../.././Init/Data/NeZero.html#NeZero">NeZero</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div><div class="structure_field_doc"><p>The width must be non-zero (i.e. positive)</p></div></li><li id="Poseidon2.Params.numFullRounds_ne_zero" class="structure_field"><div class="structure_field_info">numFullRounds_ne_zero : <span class="fn"><a href="../../.././Init/Data/NeZero.html#NeZero">NeZero</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span></span></div><div class="structure_field_doc"><p>The number of full rounds must be non-zero (i.e. positive)</p></div></li><li id="Poseidon2.Params.numPartialRounds_ne_zero" class="structure_field"><div class="structure_field_info">numPartialRounds_ne_zero : <span class="fn"><a href="../../.././Init/Data/NeZero.html#NeZero">NeZero</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numPartialRounds">numPartialRounds</a></span></span></div><div class="structure_field_doc"><p>The number of partial rounds must be non-zero (i.e. positive)</p></div></li><li id="Poseidon2.Params.width_dvd_by_4" class="structure_field"><div class="structure_field_info">width_dvd_by_4 : <span class="fn">4</span> <a href="../../.././Init/Prelude.html#Dvd.dvd">∣</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></div><div class="structure_field_doc"><p>The width must be a multiple of 4</p></div></li><li id="Poseidon2.Params.numFullRounds_even" class="structure_field"><div class="structure_field_info">numFullRounds_even : <span class="fn"><a href="../../.././Mathlib/Algebra/Group/Even.html#Even">Even</a> <span class="fn"><span class="fn">self</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span></span></div><div class="structure_field_doc"><p>The number of full rounds must be even</p></div></li></ul><details id="instances-for-list-Poseidon2.Params" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.Params.width_pos"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L441-L442">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">width_pos</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">0</span> <a href="../../.././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></div></div></div></div><div class="decl" id="Poseidon2.Params.numFullRounds_pos"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L444-L446">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numFullRounds_pos</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">0</span> <a href="../../.././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span></div></div></div></div><div class="decl" id="Poseidon2.Params.numPartialRounds_pos"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L448-L450">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numPartialRounds_pos"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numPartialRounds_pos</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">0</span> <a href="../../.././Init/Prelude.html#LT.lt">&lt;</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numPartialRounds">numPartialRounds</a></span></div></div></div></div><div class="decl" id="Poseidon2.Params.widthDiv4"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L452-L452">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.widthDiv4"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">widthDiv4</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></div><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.Params.widthDiv4" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.Params.widthDiv4_mul_4_eq_width"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L454-L456">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.widthDiv4_mul_4_eq_width"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">widthDiv4_mul_4_eq_width</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.widthDiv4">widthDiv4</a></span> <a href="../../.././Init/Prelude.html#HMul.hMul">*</a> <span class="fn">4</span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></div></div></div></div><div class="decl" id="Poseidon2.Params.halfNumFullRounds"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L458-L458">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.halfNumFullRounds"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">halfNumFullRounds</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><a href="../../.././Init/Prelude.html#Nat">ℕ</a></div></div><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.Params.halfNumFullRounds" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.Params.numFullRounds_dvd_by_2"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L460-L462">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds_dvd_by_2"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">numFullRounds_dvd_by_2</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn">2</span> <a href="../../.././Init/Prelude.html#Dvd.dvd">∣</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span></div></div></div></div><div class="decl" id="Poseidon2.Params.halfNumFullRounds_mul_2_eq_numFullRounds"><div class="theorem"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L464-L467">source</a></div><div class="attributes">@[simp]</div>
<div class="decl_header"><span class="decl_kind">theorem</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.halfNumFullRounds_mul_2_eq_numFullRounds"><span class="name">Poseidon2</span>.<span class="name">Params</span>.<span class="name">halfNumFullRounds_mul_2_eq_numFullRounds</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.halfNumFullRounds">halfNumFullRounds</a></span> <a href="../../.././Init/Prelude.html#HMul.hMul">*</a> <span class="fn">2</span> <a href="../../.././Init/Prelude.html#Eq">=</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.numFullRounds">numFullRounds</a></span></div></div></div></div><div class="decl" id="Poseidon2.params16"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L471-L495">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.params16"><span class="name">Poseidon2</span>.<span class="name">params16</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a></div></div><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.params16" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h2 class="markdown-heading" id="Parameter-set-for-width-24">Parameter set for width 24 <a class="hover-link" href="#Parameter-set-for-width-24">#</a></h2></div><div class="decl" id="Poseidon2.params24"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L499-L532">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.params24"><span class="name">Poseidon2</span>.<span class="name">params24</span></a></span><span class="decl_args"> :</span><div class="decl_type"><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a></div></div><p>Parameters for width = 24, following the Python spec.</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.params24" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="mod_doc"><h2 class="markdown-heading" id="M4-matrix-and-linear-layers">M4 matrix and linear layers <a class="hover-link" href="#M4-matrix-and-linear-layers">#</a></h2></div><div class="decl" id="Poseidon2.m4Matrix"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L536-L543">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.m4Matrix"><span class="name">Poseidon2</span>.<span class="name">m4Matrix</span></a></span><span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <span class="fn">(<a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn">4</span>)</span> <span class="fn">4</span></span></div></div><p>The M4 matrix</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.m4Matrix" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.applyM4"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L545-L548">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.applyM4"><span class="name">Poseidon2</span>.<span class="name">applyM4</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">chunk</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn">4</span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn">4</span></span></div></div><p>Multiply the m4 block with an input vector of length 4
TODO: define matrix-vector multiplication with <code><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a></code> representation generally</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.applyM4" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.externalLinearLayer"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L552-L585">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.externalLinearLayer"><span class="name">Poseidon2</span>.<span class="name">externalLinearLayer</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">state</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></div><p>Applies the external linear layer (M_E), which is structured for efficiency.</p><p>The matrix <code>M_E</code> is applied in two steps:</p><ol>
<li><p><strong>Block-Diagonal Matrix Multiplication</strong>: The <code><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></code>-element state vector is treated as a
<code>width/4 × 4</code> matrix. Each 4-element row is multiplied by the <code><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.m4Matrix">m4Matrix</a></code>.
This is equivalent to multiplying the state vector by a block-diagonal matrix where each
block is <code><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.m4Matrix">m4Matrix</a></code>.</p>
</li>
<li><p><strong>Diffusion Layer</strong>: A diffusion effect is achieved by adding the sum of all elements in each
column to every element in that same column. This mixes the state across the 4-element chunks.
If <code>s'</code> is the state after the M4 multiplication, the output is <code>s''</code> where
<code>s''_{i,j} = s'_{i,j} + ∑_k s'_{k,j}</code>.</p>
</li>
</ol><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.externalLinearLayer" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.internalLinearLayer"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L587-L606">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.internalLinearLayer"><span class="name">Poseidon2</span>.<span class="name">internalLinearLayer</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">state</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></div><p>Applies the internal linear layer (M_I), optimized for partial rounds.</p><p>This layer's matrix is <code>M_I = J + D</code>, where <code>J</code> is the all-ones matrix and <code>D</code> is a
diagonal matrix defined by <code><a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.internalDiagVectors">internalDiagVectors</a></code>. This structure allows the matrix-vector
product <code>M_I * s</code> to be computed in <code>O(width)</code> time instead of <code>O(width^2)</code>.</p><p>The computation is performed as <code>M_I * s = J*s + D*s</code>:</p><ul>
<li><code>J*s</code> is a vector where each element is the sum of all elements in <code>s</code>.</li>
<li><code>D*s</code> is the element-wise product of the state <code>s</code> and the diagonal vector <code>d</code>.</li>
</ul><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.internalLinearLayer" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.fullRound"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L608-L616">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.fullRound"><span class="name">Poseidon2</span>.<span class="name">fullRound</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">state </span><span class="fn">roundConstants</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></div><p>A single full round of the Poseidon2 permutation.</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.fullRound" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.partialRound"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L618-L626">source</a></div><div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.partialRound"><span class="name">Poseidon2</span>.<span class="name">partialRound</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">state</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">roundConstant</span> : <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></div><p>A single partial round of the Poseidon2 permutation.</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.partialRound" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div><div class="decl" id="Poseidon2.permute"><div class="def"><div class="gh_link"><a href="https://github.com/Verified-zkEVM/ArkLib/blob/06102f457d5f1583099557f4cc414e62d6f68e6a/ArkLib/Data/Hash/Poseidon2.lean#L628-L662">source</a></div><div class="attributes">@[inline]</div>
<div class="decl_header"><span class="decl_kind">def</span>
<span class="decl_name"><a class="break_within" href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.permute"><span class="name">Poseidon2</span>.<span class="name">permute</span></a></span><span class="decl_args">
<span class="fn">(<span class="fn">params</span> : <a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params">Params</a>)</span></span>
<span class="decl_args">
<span class="fn">(<span class="fn">state</span> : <span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span>)</span></span>
<span class="decl_args"> :</span><div class="decl_type"><span class="fn"><a href="../../.././Init/Data/Vector/Basic.html#Vector">Vector</a> <a href="../../.././ArkLib/Data/FieldTheory/NonBinaryField/KoalaBear.html#KoalaBear.Field">KoalaBear.Field</a> <span class="fn"><span class="fn">params</span>.<a href="../../.././ArkLib/Data/Hash/Poseidon2.html#Poseidon2.Params.width">width</a></span></span></div></div><p>Full Poseidon2 permutation on a state vector.</p><details><summary>Equations</summary><ul class="equations"></ul></details><details id="instances-for-list-Poseidon2.permute" class="instances-for-list"><summary>Instances For</summary><ul class="instances-for-enum"></ul></details></div></div></main>
<nav class="nav"><iframe src="../../.././navbar.html" class="navframe" frameBorder="0"></iframe></nav></body></html>